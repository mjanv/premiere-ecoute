# AIDEV-NOTE: Traefik dynamic configuration - routing rules
# Separate routers needed because Let's Encrypt cannot issue certs for IP addresses
http:
  routers:
    app-domain:
      rule: "Host(`premiere-ecoute.fr`)"
      service: app
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt
        options: no-h2

    app-ip:
      rule: "Host(`68.183.219.251`)"
      service: app
      entryPoints:
        - websecure
      tls: {}

  services:
    app:
      loadBalancer:
        servers:
          - url: "http://localhost:4000"

# AIDEV-NOTE: HTTP/2 disabled via ALPN â€” HTTP/2 strips Connection/Upgrade headers, breaking Phoenix LiveView WebSocket upgrades
tls:
  options:
    no-h2:
      alpnProtocols:
        - http/1.1
